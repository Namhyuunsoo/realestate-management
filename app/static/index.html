<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>ë§¤ë¬¼ í”„ë¡œí† íƒ€ì… v0.3</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" href="data:,">
  <link rel="stylesheet" href="/static/css/style.css?v=20250803">
  <script src="/static/js/main-new.js"></script>
  <script src="/static/js/listing-add.js"></script>
  <script>
    async function loadNaverMapsAPI() {
      return new Promise(async (resolve, reject) => {
        try {
          // ì„œë²„ì—ì„œ API í‚¤ ê°€ì ¸ì˜¤ê¸°
          console.log('ğŸ”‘ API ì„¤ì • ìš”ì²­ ì¤‘...');
          const response = await fetch('/api/config/maps');
          if (!response.ok) {
            throw new Error(`API ì„¤ì • ìš”ì²­ ì‹¤íŒ¨: ${response.status} ${response.statusText}`);
          }
          
          const config = await response.json();
          console.log('ğŸ”‘ ë„¤ì´ë²„ ì§€ë„ API ì„¤ì • ë¡œë“œë¨:', config);
          
          // API í‚¤ ìœ íš¨ì„± ê²€ì‚¬
          if (!config.ncpKeyId) {
            throw new Error('API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
          }
          
          // ì¸ì¦ ì‹¤íŒ¨ ì²˜ë¦¬ í•¨ìˆ˜ ì •ì˜
          window.navermap_authFailure = function () {
            console.error('âŒ ë„¤ì´ë²„ ì§€ë„ API ì¸ì¦ ì‹¤íŒ¨');
            showToast('ë„¤ì´ë²„ ì§€ë„ API ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.', 'error');
          };
          
          // ìŠ¤í¬ë¦½íŠ¸ ìƒì„± (ë¬¸ì„œì— ë”°ë¥¸ ì˜¬ë°”ë¥¸ ë°©ì‹)
          const script = document.createElement('script');
          script.type = 'text/javascript';
          // ncpKeyIdë§Œ ì‚¬ìš© (ncpClientIdëŠ” ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ)
          const apiUrl = `https://openapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=${config.ncpKeyId}&submodules=geocoder,panorama`;
          script.src = apiUrl;
          console.log('ğŸ”— ë„¤ì´ë²„ ì§€ë„ API URL:', apiUrl);
          
          // ë¡œë“œ ì„±ê³µ ì‹œ
          script.onload = function() {
            console.log('âœ… ë„¤ì´ë²„ ì§€ë„ API ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì™„ë£Œ');
            window.naverMapLoadStatus = 'loaded';
            
            // naver.maps APIê°€ ì™„ì „íˆ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
            const checkAPILoaded = () => {
              if (window.naver && window.naver.maps && 
                  typeof naver.maps.Map === 'function' && 
                  typeof naver.maps.LatLng === 'function' &&
                  typeof naver.maps.Size === 'function') {
                console.log('âœ… ëª¨ë“  naver.maps APIê°€ ë¡œë“œë¨');
                
                // initMap í•¨ìˆ˜ê°€ ì •ì˜ë  ë•Œê¹Œì§€ ëŒ€ê¸°
                const checkInitMap = () => {
                  if (typeof window.initMap === 'function') {
                    console.log('âœ… initMap í•¨ìˆ˜ ë°œê²¬, ì§€ë„ ì´ˆê¸°í™” ì‹œì‘');
                    // ì•½ê°„ì˜ ì§€ì—°ì„ ë‘ê³  initMap í˜¸ì¶œ
                    setTimeout(() => {
                      try {
                        window.initMap();
                        resolve();
                      } catch (error) {
                        console.error('âŒ initMap ì‹¤í–‰ ì‹¤íŒ¨:', error);
                        reject(error);
                      }
                    }, 100);
                  } else {
                    console.log('ğŸ”„ initMap í•¨ìˆ˜ ëŒ€ê¸° ì¤‘...');
                    setTimeout(checkInitMap, 100);
                  }
                };
                checkInitMap();
              } else {
                console.log('ğŸ”„ naver.maps API ë¡œë“œ ëŒ€ê¸° ì¤‘...');
                console.log('ğŸ” naver:', !!window.naver);
                console.log('ğŸ” naver.maps:', !!window.naver?.maps);
                console.log('ğŸ” naver.maps.Map:', typeof window.naver?.maps?.Map);
                console.log('ğŸ” naver.maps.LatLng:', typeof window.naver?.maps?.LatLng);
                console.log('ğŸ” naver.maps.Size:', typeof window.naver?.maps?.Size);
                setTimeout(checkAPILoaded, 100);
              }
            };
            
            // ì¦‰ì‹œ ì²´í¬ ì‹œì‘
            checkAPILoaded();
          };
          
          // ë¡œë“œ ì‹¤íŒ¨ ì‹œ
          script.onerror = function(error) {
            console.error('âŒ ë„¤ì´ë²„ ì§€ë„ API ë¡œë“œ ì‹¤íŒ¨:', error);
            window.naverMapLoadStatus = 'error';
            reject(new Error('ë„¤ì´ë²„ ì§€ë„ APIë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'));
          };
          
          // ìŠ¤í¬ë¦½íŠ¸ë¥¼ headì— ì¶”ê°€
          document.head.appendChild(script);
          
        } catch (error) {
          console.error('âŒ API ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', error);
          reject(error);
        }
      });
    }
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ë„¤ì´ë²„ ì§€ë„ API ë¡œë“œ
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', loadNaverMapsAPI);
    } else {
      loadNaverMapsAPI();
    }
  </script>
</head>

<body>
      <!-- ë¡œê·¸ì¸ í•„ìš” ì•ˆë‚´ í™”ë©´ -->
    <div id="loginRequiredScreen" class="login-required-screen hidden">
      <div class="login-required-box">
        <h2 style="margin-bottom:16px;">ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</h2>
        <p style="margin-bottom:24px; color:#666;">ë§¤ë¬¼ ê´€ë¦¬ ì‹œìŠ¤í…œì„ ì‚¬ìš©í•˜ë ¤ë©´ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.</p>
        
        <!-- ì¸ë¼ì¸ ë¡œê·¸ì¸ í¼ -->
        <form id="inlineLoginForm" class="login-form">
          <div class="form-group">
            <label for="inlineLoginEmail">ì´ë©”ì¼</label>
            <input type="email" id="inlineLoginEmail" name="email" placeholder="email@example.com" required>
          </div>
          
          <div class="form-group">
            <label for="inlineLoginPassword">ë¹„ë°€ë²ˆí˜¸</label>
            <input type="password" id="inlineLoginPassword" name="password" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
          </div>
          
          <div id="inlineLoginErrorMsg" class="error-message"></div>
          
          <button type="submit" class="btn btn-primary">ë¡œê·¸ì¸</button>
          
          <div class="login-links">
            <a href="/register">íšŒì›ê°€ì…</a>
            <a href="#" onclick="alert('ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.')">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</a>
          </div>
        </form>
      </div>
    </div>

  <!-- ì•± ì¢…ë£Œ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ -->
  <div id="exitConfirmOverlay" class="exit-confirm-overlay hidden">
    <div class="exit-confirm-dialog">
      <div class="exit-confirm-header">
        <h3>ì•± ì¢…ë£Œ</h3>
      </div>
      <div class="exit-confirm-body">
        <div class="exit-confirm-message">
          ì•±ì„ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?
        </div>
        <div class="exit-confirm-buttons">
          <button type="button" class="exit-confirm-btn cancel" id="exitCancelBtn">ì·¨ì†Œ</button>
          <button type="button" class="exit-confirm-btn confirm" id="exitConfirmBtn">í™•ì¸</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ì‹¤ì œ ì•± í™”ë©´ -->
  <div id="appRoot" class="hidden">
    <!-- ìƒë‹¨ë°” -->
    <header id="topbar">
      <div class="office-info">
        <span id="officeName">SKê³µì¸ì¤‘ê°œì‚¬ì‚¬ë¬´ì†Œ</span>
        <span id="userRoleName" class="user-role-name">ì§ì±… / ì‚¬ìš©ìëª…</span>
        <!-- ëª¨ë“œ ì „í™˜ ë²„íŠ¼ -->
        <div class="mode-switch">
          <button id="modeToggleBtn" class="mode-toggle-btn" type="button">
            <span id="modeText">ì¤‘ê°œì‚¬</span>
            <span id="modeIcon">ğŸ‘¥</span>
          </button>
        </div>
      </div>
      <div class="auth-links">
        <!-- ì–´ë“œë¯¼ ì „ìš© ë©”ë‰´ -->
        <div class="admin-only hidden">
          <button id="userManagementBtn" class="admin-btn" type="button">ì‚¬ìš©ì ê´€ë¦¬</button>
          <button id="adminStatsBtn" class="admin-btn" type="button">í†µê³„</button>
        </div>

        <a id="logoutBtn" href="/auth/logout" class="hidden">ë¡œê·¸ì•„ì›ƒ</a>
      </div>
    </header>

    <!-- ìƒíƒœì¹´ìš´íŠ¸ë°” -->
    <div id="statusCounts">
      <div class="count-info">
        ì´ <span id="countTotal">0</span>ê±´ / í•„í„° í›„ <span id="countFiltered">0</span>ê±´
        <button id="addListingBtn" class="btn-add-listing">ğŸ“ ë§¤ë¬¼ë“±ë¡</button>
      </div>
      <div class="sheet-controls">
        <div class="sheet-buttons">
          <!-- ë§¤ë¬¼ì¥ ë²„íŠ¼ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
        </div>
        <button id="openGoogleSheetBtn" class="btn-sheet-open">
          ì„ íƒëœ ì‹œíŠ¸ ì—´ê¸°
        </button>
        
        <!-- ìƒˆë¡œ ì¶”ê°€: ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ ê·¸ë£¹ -->
        <div class="refresh-controls">
          <button id="refreshDataBtn" class="refresh-btn" title="ë§¤ë¬¼ ë°ì´í„° ìƒˆë¡œê³ ì¹¨">
            ğŸ”„ ìƒˆë¡œê³ ì¹¨
          </button>
          <span class="last-update">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: <span id="lastUpdateTime">-</span></span>
        </div>
      </div>
    </div>
    
    <!-- ë§¤ë¬¼ë“±ë¡ ëª¨ë‹¬ -->
    <div id="listingAddModal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h2>ë§¤ë¬¼ë“±ë¡</h2>
          <button class="modal-close" id="closeListingModal">&times;</button>
        </div>
        <div class="modal-body">
          <form id="listingAddForm">
            <div class="form-row">
              <div class="form-group">
                <label for="ì ‘ìˆ˜ë‚ ì§œ">ì ‘ìˆ˜ë‚ ì§œ</label>
                <input type="text" id="ì ‘ìˆ˜ë‚ ì§œ" name="ì ‘ìˆ˜ë‚ ì§œ" placeholder="ìë™ì…ë ¥" readonly>
              </div>
              <div class="form-group">
                <label for="ì§€ì—­">ì§€ì—­</label>
                <input type="text" id="ì§€ì—­" name="ì§€ì—­" placeholder="ì˜ˆ: ë¶€í‰ë™">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="ì§€ë²ˆ">ì§€ë²ˆ</label>
                <input type="text" id="ì§€ë²ˆ" name="ì§€ë²ˆ" placeholder="ì˜ˆ: 123-45">
              </div>
              <div class="form-group">
                <label for="ê±´ë¬¼ëª…">ê±´ë¬¼ëª…</label>
                <input type="text" id="ê±´ë¬¼ëª…" name="ê±´ë¬¼ëª…" placeholder="ê±´ë¬¼ëª…">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="ì¸µìˆ˜">ì¸µìˆ˜</label>
                <input type="text" id="ì¸µìˆ˜" name="ì¸µìˆ˜" placeholder="ì˜ˆ: 3ì¸µ">
              </div>
              <div class="form-group">
                <label for="ê°€ê²Œëª…">ê°€ê²Œëª…</label>
                <input type="text" id="ê°€ê²Œëª…" name="ê°€ê²Œëª…" placeholder="ê°€ê²Œëª…">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="ë¶„ì–‘">ë¶„ì–‘</label>
                <input type="text" id="ë¶„ì–‘" name="ë¶„ì–‘" placeholder="ì˜ˆ: ì„ëŒ€">
              </div>
              <div class="form-group">
                <label for="ì‹¤í‰ìˆ˜">ì‹¤í‰ìˆ˜</label>
                <input type="text" id="ì‹¤í‰ìˆ˜" name="ì‹¤í‰ìˆ˜" placeholder="ì˜ˆ: 15í‰">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="ë³´ì¦ê¸ˆ">ë³´ì¦ê¸ˆ</label>
                <input type="text" id="ë³´ì¦ê¸ˆ" name="ë³´ì¦ê¸ˆ" placeholder="ìˆ«ìë§Œ ì…ë ¥">
              </div>
              <div class="form-group">
                <label for="ì›”ì„¸">ì›”ì„¸</label>
                <input type="text" id="ì›”ì„¸" name="ì›”ì„¸" placeholder="ìˆ«ìë§Œ ì…ë ¥">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="ê¶Œë¦¬ê¸ˆ">ê¶Œë¦¬ê¸ˆ</label>
                <input type="text" id="ê¶Œë¦¬ê¸ˆ" name="ê¶Œë¦¬ê¸ˆ" placeholder="ìˆ«ìë§Œ ì…ë ¥">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group full-width">
                <label for="ë¹„ê³ ">ë¹„ê³ </label>
                <textarea id="ë¹„ê³ " name="ë¹„ê³ " placeholder="ë¹„ê³ ì‚¬í•­" rows="3"></textarea>
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="ë‹´ë‹¹ì">ë‹´ë‹¹ì</label>
                <input type="text" id="ë‹´ë‹¹ì" name="ë‹´ë‹¹ì" placeholder="ë‹´ë‹¹ìëª…">
              </div>
              <div class="form-group">
                <label for="ì—°ë½ì²˜">ì—°ë½ì²˜</label>
                <input type="text" id="ì—°ë½ì²˜" name="ì—°ë½ì²˜" placeholder="010-1234-5678" required>
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="ì˜ë¢°ì¸">ì˜ë¢°ì¸</label>
                <input type="text" id="ì˜ë¢°ì¸" name="ì˜ë¢°ì¸" placeholder="ì˜ë¢°ì¸ëª…">
              </div>
              <div class="form-group">
                <label for="ë¹„ê³ 3">ë¹„ê³ 3</label>
                <input type="text" id="ë¹„ê³ 3" name="ë¹„ê³ 3" placeholder="ë¹„ê³ 3">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="ìœ„ë°˜ì—¬ë¶€">ìœ„ë°˜ì—¬ë¶€</label>
                <input type="text" id="ìœ„ë°˜ì—¬ë¶€" name="ìœ„ë°˜ì—¬ë¶€" placeholder="ì˜ˆ: ì—†ìŒ">
              </div>
              <div class="form-group">
                <label for="í˜„ìˆ˜ë§‰ë²ˆí˜¸">í˜„ìˆ˜ë§‰ë²ˆí˜¸</label>
                <input type="text" id="í˜„ìˆ˜ë§‰ë²ˆí˜¸" name="í˜„ìˆ˜ë§‰ë²ˆí˜¸" placeholder="ì˜ˆ: A-001">
              </div>
            </div>
            
            <!-- ìˆ¨ê¹€ í•„ë“œë“¤ -->
            <input type="hidden" id="í˜„í™©" name="í˜„í™©" value="ìƒ">
            <input type="hidden" id="ì§€ì—­2" name="ì§€ì—­2" value="">
            <input type="hidden" id="ê°„ëµí•œìœ„ì¹˜" name="ê°„ëµí•œìœ„ì¹˜" value="">
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" id="submitListing" class="btn-primary">ë“±ë¡</button>
          <button type="button" id="cancelListing" class="btn-secondary">ì·¨ì†Œ</button>
        </div>
      </div>
    </div>

    <!-- ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ -->
    <div id="contextMenu" class="context-menu">
      <div class="context-menu-item" data-action="edit">
        <span>âœï¸</span> ìˆ˜ì •
      </div>
      <div class="context-menu-separator"></div>
      <div class="context-menu-item danger" data-action="delete">
        <span>ğŸ—‘ï¸</span> ì‚­ì œ
      </div>
    </div>

    <!-- ìƒë‹¨ í•„í„°ë°” -->
    <section id="topFilterBar" class="top-filter">
      <!-- ë¼ë²¨ í–‰ -->
      <div class="tf-row tf-labels">
        <div>ì§€ì—­</div><div>ì§€ë²ˆ</div><div>ê±´ë¬¼ëª…</div><div>ì¸µìˆ˜</div><div>ê°€ê²Œëª…</div>
        <div>ë¶„ì–‘</div><div>ì‹¤í‰ìˆ˜</div><div>ë³´ì¦ê¸ˆ</div><div>ì›”ì„¸</div><div>ê¶Œë¦¬ê¸ˆ</div>
        <div>ë¹„ê³ </div><div>ë‹´ë‹¹ì</div><div>ì§€ì—­2</div><div>ì—°ë½ì²˜</div><div>ì˜ë¢°ì¸</div>
        <div>ë¹„ê³ 3</div><div class="tf-actions"></div>
      </div>
      <!-- ì…ë ¥ í–‰ -->
      <div class="tf-row tf-inputs">
        <input id="tf_region"    placeholder="ì‰¼í‘œë¡œ ë³µìˆ˜ê²€ìƒ‰">
        <input id="tf_jibun"     placeholder="ì˜ˆ: 123-45, 12-3">
        <input id="tf_building"  placeholder="ê±´ë¬¼ëª…">
        <input id="tf_floor"     placeholder="ë‹¨ì¼ ë˜ëŠ” a-b">
        <input id="tf_store"     placeholder="ê°€ê²Œëª…">
        <input id="tf_area_sale" placeholder="ë¶„ì–‘í‰ (>=ê°’ ë˜ëŠ” aâ€‘b)">
        <input id="tf_area_real" placeholder="ì‹¤í‰ìˆ˜ (>=ê°’ ë˜ëŠ” aâ€‘b)">
        <input id="tf_deposit"   placeholder="ë³´ì¦ê¸ˆ (<=ê°’ ë˜ëŠ” aâ€‘b)">
        <input id="tf_rent"      placeholder="ì›”ì„¸ (<=ê°’ ë˜ëŠ” aâ€‘b)">
        <input id="tf_premium"   placeholder="ê¶Œë¦¬ê¸ˆ (<=ê°’ ë˜ëŠ” aâ€‘b)">
        <input id="tf_note"      placeholder="ë¹„ê³ ">
        <input id="tf_manager"   placeholder="ë‹´ë‹¹ì">
        <input id="tf_region2"   placeholder="ì§€ì—­2">
        <input id="tf_phone"     placeholder="ì—°ë½ì²˜">
        <input id="tf_client"    placeholder="ì˜ë¢°ì¸">
        <input id="tf_note3"     placeholder="ë¹„ê³ 3">
        <div class="tf-actions">
          <button id="topFilterApplyBtn" type="button">ì ìš©</button>
          <button id="topFilterResetBtn" type="button">ì´ˆê¸°í™”</button>
        </div>
      </div>
    </section>

    <!-- ë³¸ë¬¸ ë ˆì´ì•„ì›ƒ -->
    <div id="layout">
      <!-- ëª¨ë°”ì¼ ë…¸ì¹˜ (í•˜ë‹¨ì— í•­ìƒ ë³´ì´ëŠ” ë…¸ì¹˜) -->
      <div class="mobile-notch"></div>
      
      <!-- 1ì°¨ ì‚¬ì´ë“œë°” -->
      <aside id="sidebar">
        <!-- ì‚¬ì´ë“œë°” í† ê¸€ ë²„íŠ¼ -->
        <div class="sidebar-toggle">
          <button id="sidebarToggleBtn" class="toggle-btn" title="ì‚¬ì´ë“œë°” ì ‘ê¸°/í¼ì¹˜ê¸°">â—€</button>
        </div>
        
        <!-- ê³ ê° ì»¨íŠ¸ë¡¤ -->
        <div id="customerControls" class="block">
          <div class="button-row">
            <button id="customerListBtn" type="button">ê³ ê°List</button>
            <button id="newCustomerBtn" type="button">ì‹ ê·œë“±ë¡</button>
          </div>
          
          <!-- ê³ ê° ëª©ë¡ (ê³ ê°List í´ë¦­ ì‹œ í‘œì‹œ) -->
          <div id="customerListContainer" class="customer-list-container hidden">
            <div id="customerListContent1">
              <!-- ê³ ê° ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
            </div>
          </div>
          
          <!-- ì„ íƒëœ ê³ ê° ì •ë³´ (ê³ ê° ì„ íƒ ì‹œ í‘œì‹œ) -->
          <div id="selectedCustomerInfo" class="selected-customer-info hidden">
            <div id="customerInfoContent">
              <!-- ì„ íƒëœ ê³ ê° ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
          </div>
        </div>



        <!-- ë§¤ë¬¼ ë¦¬ìŠ¤íŠ¸ ì»¨íŠ¸ë¡¤ -->
        <div id="listingControls" class="block">
          <div class="listing-header">
            <div class="listing-mode-buttons hidden">
              <button id="propertyListBtn" type="button" class="mode-btn active">ë§¤ë¬¼ë¦¬ìŠ¤íŠ¸</button>
              <button id="briefingListBtn" type="button" class="mode-btn">ë¸Œë¦¬í•‘ë¦¬ìŠ¤íŠ¸</button>
            </div>
          </div>
          <div class="listing-actions">
            <button id="viewAllBtn" type="button">ì „ì²´ë³´ê¸°</button>
            <button class="sortBtn" data-sort="latest" type="button">ìµœì‹ </button>
            <button class="sortBtn" data-sort="area"   type="button">ë©´ì </button>
            <button class="sortBtn" data-sort="deposit" type="button">ë³´ì¦ê¸ˆ</button>
            <button class="sortBtn" data-sort="rent"    type="button">ì›”ì„¸</button>
            <button class="sortBtn" data-sort="index"   type="button">ìƒ‰ì¸</button>
          </div>
        </div>

        <!-- ë§¤ë¬¼ ëª©ë¡ -->
        <div id="listingSidebarWrap" class="block listings-block">
          <ul id="listingList"></ul>
          
          <!-- í´ëŸ¬ìŠ¤í„° ë§¤ë¬¼ ëª©ë¡ -->
          <div id="clusterList" class="cluster-list hidden">
            <div class="cluster-list-header">
              <label class="cluster-list-title">í´ëŸ¬ìŠ¤í„° ë§¤ë¬¼ ëª©ë¡</label>
              <button id="clusterListCloseBtn" class="cluster-close-btn" type="button" title="ë‹«ê¸°">Ã—</button>
            </div>
            <ul id="clusterItemList"></ul>
          </div>
        </div>
      </aside>

      <!-- 2ì°¨ ì‚¬ì´ë“œë°”: panel-view ì™¸ ë¶ˆí•„ìš”í•œ div/ì»¨í…Œì´ë„ˆ ì œê±°, êµ¬ì¡° ëª…í™•í™” -->
      <aside id="secondaryPanel" class="sidepanel">
        <div class="panel-header">
          <span id="secondaryPanelTitle">ìƒì„¸ì •ë³´</span>
          <div class="panel-controls">
            <button id="secondaryPanelToggleBtn" class="toggle-btn" title="2ì°¨ ì‚¬ì´ë“œë°” ì ‘ê¸°/í¼ì¹˜ê¸°">â—€</button>
            <button id="secondaryPanelClose" class="panel-close" type="button" onclick="closeSecondaryPanel(); return false;">Ã—</button>
          </div>
        </div>
  <div class="panel-body" id="secondaryPanelBody">
    <div id="viewCustomerList" class="panel-view hidden">
      <div class="customer-list-container">
        <div id="customerListContent2"></div>
      </div>
    </div>
    <div id="viewCustomerDetail" class="panel-view hidden">
      <div class="customer-detail-container">
        <div id="customerDetailContent"></div>
      </div>
    </div>
    <div id="viewCustomerForm" class="panel-view hidden">
      <form id="customerForm"></form>
    </div>
    <div id="viewCustomerEdit" class="panel-view hidden">
      <form id="customerEditForm"></form>
    </div>
    <div id="viewListingDetail" class="panel-view hidden"></div>
  </div>
</aside>


      <!-- ë©”ì¸ ì½˜í…ì¸ (ì§€ë„) -->
      <main id="mainContent">
        <div id="mapWrap">
          <div id="map"></div>
          <div id="mapCenterCross"></div>
          
          <!-- ì§€ë„ ì»¨íŠ¸ë¡¤ -->
          <div id="mapControls" class="map-controls">
            <div class="map-control-group">
              <!-- ë¸Œë¦¬í•‘í˜„í™© í•„í„° -->
              <div id="briefingFilter" class="briefing-filter map-control-briefing-filter">
                <button id="briefingFilterBtn" class="briefing-filter-btn" onclick="toggleBriefingFilter()">
                  ë¸Œë¦¬í•‘
                </button>
                <div id="briefingFilterDropdown" class="briefing-filter-dropdown hidden">
                  <label class="briefing-option">
                    <input type="checkbox" id="filterNormal" checked>
                    <span class="briefing-status normal"></span>
                    <span class="briefing-text">ì¼ë°˜</span>
                  </label>
                  <label class="briefing-option">
                    <input type="checkbox" id="filterPending" checked>
                    <span class="briefing-status pending"></span>
                    <span class="briefing-text">ì˜ˆì •</span>
                  </label>
                  <label class="briefing-option">
                    <input type="checkbox" id="filterCompleted" checked>
                    <span class="briefing-status completed"></span>
                    <span class="briefing-text">ì™„ë£Œ</span>
                  </label>
                  <label class="briefing-option">
                    <input type="checkbox" id="filterOnHold" checked>
                    <span class="briefing-status onhold"></span>
                    <span class="briefing-text">ë³´ë¥˜</span>
                  </label>
                </div>
              </div>
              
              <button id="roadviewBtn" class="map-control-btn" title="ë¡œë“œë·°">
                <span class="control-icon">ğŸ›£ï¸</span>
              </button>
              <button id="cadastralBtn" class="map-control-btn" title="ìœ„ì„±ì§€ë„">
                <span class="control-icon">ğŸ›°ï¸</span>
              </button>
              <button id="distanceBtn" class="map-control-btn" title="ê±°ë¦¬ì œê¸°">
                <span class="control-icon">ğŸ“</span>
              </button>
            </div>
          </div>
          
          <!-- ë¡œë“œë·° ì»¨í…Œì´ë„ˆ -->
          <div id="roadviewContainer" class="roadview-container hidden">
            <!-- ë¡œë“œë·° ë‹«ê¸° ë²„íŠ¼ -->
            <button id="roadviewCloseBtn" class="roadview-close-btn">Ã—</button>
            
            <!-- ë¡œë“œë·° ë©”ì¸ ì½˜í…ì¸  -->
            <div id="roadview" class="roadview-content"></div>
            
            <!-- ì£¼ì†Œ ì •ë³´ ë°•ìŠ¤ (ë¯¸ë‹ˆë§µ ìœ„ì— ë°°ì¹˜) -->
            <div class="roadview-address-box">
              <div class="address-icon">ğŸ“</div>
              <div class="address-content">
                <div class="road-name">ë¶€í‰ëŒ€ë¡œ</div>
                <div class="address">ì¸ì²œ ë¶€í‰êµ¬ ë¶€í‰ë™</div>
              </div>
              <div class="address-actions">
                <span class="date-badge">2025ë…„ 05ì›”(ìµœì‹ )</span>
                <span class="view-mode">3D</span>
              </div>
            </div>
            
            <!-- ë¡œë“œë·° ë¯¸ë‹ˆë§µ -->
            <div id="roadviewMiniMap" class="roadview-minimap">
              <div class="minimap-label">ğŸ—ºï¸ ë¯¸ë‹ˆë§µ</div>
              <div class="minimap-header">
                <button class="minimap-menu-btn">â˜°</button>
              </div>
              <div class="minimap-content"></div>
              <div class="minimap-controls">
                <button class="minimap-expand-btn">â¤¢</button>
                <div class="minimap-zoom">
                  <button class="zoom-in">+</button>
                  <button class="zoom-out">-</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ì „ì²´ë³´ê¸° íŒ¨ë„ -->
        <div id="fullListPanel" class="full-list-panel hidden">
          <div class="full-list-header">
            <span>ì „ì²´ë³´ê¸°</span>
            <button id="fullListCloseBtn" type="button" style="background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 11px; cursor: pointer; margin-left: auto;">ë‹«ê¸°</button>
          </div>
          <div id="fullListContent" class="full-list-body">
            <div style="padding:12px;color:#666;">(ì „ì²´ë³´ê¸° ë‚´ìš©ì´ ì—¬ê¸° í‘œì‹œë©ë‹ˆë‹¤)</div>
          </div>
        </div>

        <!-- ì „ì²´ ë¸Œë¦¬í•‘ ë¦¬ìŠ¤íŠ¸ íŒ¨ë„ -->
        <div id="fullBriefingListPanel" class="full-list-panel hidden">
          <div class="full-list-header">
            <span>ì „ì²´ ë¸Œë¦¬í•‘ ë¦¬ìŠ¤íŠ¸</span>
            <button id="fullBriefingListCloseBtn" type="button" style="background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 11px; cursor: pointer; margin-left: auto;">ë‹«ê¸°</button>
          </div>
          <div id="fullBriefingListContent" class="full-list-body">
            <div style="padding:12px;color:#666;">(ì „ì²´ ë¸Œë¦¬í•‘ ë¦¬ìŠ¤íŠ¸ ë‚´ìš©ì´ ì—¬ê¸° í‘œì‹œë©ë‹ˆë‹¤)</div>
          </div>
        </div>
      </main>

    </div>

    <!-- ì–´ë“œë¯¼ ëª¨ë‹¬ë“¤ -->
    <!-- ì‚¬ìš©ì ê´€ë¦¬ ëª¨ë‹¬ -->
    <div id="userManagementModal" class="modal hidden">
      <div class="modal-content user-management-modal">
        <div class="modal-header">
          <h2>ì‚¬ìš©ì ê´€ë¦¬</h2>
          <button class="modal-close-btn">&times;</button>
        </div>
        <div class="modal-body">
          <div class="table-container">
            <table class="user-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>ì´ë©”ì¼</th>
                  <th>ì´ë¦„</th>
                  <th>ì§ì±…</th>
                  <th>ì—­í• </th>
                  <th>ë‹´ë‹¹ìëª…</th>
                  <th>ìƒíƒœ</th>
                  <th>ê°€ì…ì¼</th>
                  <th>ì‹œíŠ¸ì§€ì •</th>
                  <th>ì‘ì—…</th>
                </tr>
              </thead>
              <tbody id="userListTableBody">
                <!-- ì‚¬ìš©ì ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- ì‚¬ìš©ì ì¶”ê°€/í¸ì§‘ ëª¨ë‹¬ -->
    <div id="userFormModal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="userFormTitle">ì‚¬ìš©ì ì¶”ê°€</h3>
          <button class="modal-close-btn">&times;</button>
        </div>
        <div class="modal-body">
          <form id="userForm">
            <div class="form-group">
              <label for="userEmail">ì´ë©”ì¼</label>
              <input type="email" id="userEmail" name="email" required>
            </div>
            <div class="form-group">
              <label for="userName">ì´ë¦„</label>
              <input type="text" id="userName" name="name" required>
            </div>
            <div class="form-group">
              <label for="userRole">ì—­í• </label>
              <select id="userRole" name="role">
                <option value="user">ì¼ë°˜ ì‚¬ìš©ì</option>
                <option value="manager">ë§¤ë‹ˆì €</option>
                <option value="admin">ê´€ë¦¬ì</option>
              </select>
            </div>
            <div class="form-group">
              <label for="userManagerName">ë‹´ë‹¹ìëª…</label>
              <input type="text" id="userManagerName" name="manager_name" placeholder="ì˜ˆ: ë‚¨, ì •, ì˜¤, ê³ ë¬¸ ë“±">
              <small style="color: #666; font-size: 12px;">
                ì¼ë°˜ ì‚¬ìš©ìì˜ ê²½ìš° ë‹´ë‹¹ìëª…ì„ ì„¤ì •í•˜ë©´ í•´ë‹¹ ë‹´ë‹¹ì ë§¤ë¬¼ë§Œ ì¡°íšŒë©ë‹ˆë‹¤.
              </small>
            </div>
            <div class="form-group">
              <label>ìƒíƒœ</label>
              <div id="userStatusGroup" class="radio-group">
                <label style="margin-right:12px;"><input type="radio" name="is_active" value="true"> í™œì„±</label>
                <label><input type="radio" name="is_active" value="false"> ë¹„í™œì„±</label>
              </div>
            </div>
            <div class="form-group">
              <label>ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •</label>
              <div style="display: flex; gap: 10px; align-items: center;">
                <input type="password" id="userNewPassword" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ (6ì ì´ìƒ)" style="flex: 1;">
                <button type="button" id="resetPasswordBtn" class="btn-secondary">ì¬ì„¤ì •</button>
              </div>
              <small style="color: #666; font-size: 12px;">ë¹„ë°€ë²ˆí˜¸ë¥¼ ìƒì–´ë²„ë¦° ê²½ìš°ì—ë§Œ ì‚¬ìš©í•˜ì„¸ìš”.</small>
            </div>
            <div class="form-actions">
              <button type="submit" class="admin-btn">ì €ì¥</button>
              <button type="button" id="userFormCancelBtn" class="btn-secondary">ì·¨ì†Œ</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- í†µê³„ ëª¨ë‹¬ -->
    <div id="adminStatsModal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h3>ê´€ë¦¬ì í†µê³„</h3>
          <button class="modal-close-btn">&times;</button>
        </div>
        <div class="modal-body">
          <div id="statsContent">
            <!-- í†µê³„ ë‚´ìš©ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
          </div>
        </div>
      </div>
    </div>

    <!-- ì‹œíŠ¸ì§€ì • ëª¨ë‹¬ -->
    <div id="sheetUrlModal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h3>ì‹œíŠ¸ì§€ì •</h3>
          <button class="modal-close-btn" id="closeSheetUrlModal">&times;</button>
        </div>
        <div class="modal-body">
          <form id="sheetUrlForm">
            <div class="form-group">
              <label for="sheetUrl">Google Sheets URL</label>
              <input type="url" id="sheetUrl" name="sheet_url" 
                     placeholder="https://docs.google.com/spreadsheets/d/..." required>
              <small style="color: #666; font-size: 12px;">
                ì‚¬ìš©ìì˜ ê°œì¸ ë§¤ë¬¼ì¥ ì‹œíŠ¸ URLì„ ì…ë ¥í•˜ì„¸ìš”.
              </small>
            </div>
            <div class="form-actions">
              <button type="submit" class="admin-btn">í™•ì¸</button>
              <button type="button" id="sheetUrlCancelBtn" class="btn-secondary">ì·¨ì†Œ</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <script>
      // MarkerClustering ë¡œë”© í™•ì¸
      document.addEventListener('DOMContentLoaded', function() {
        console.log('ğŸ” ì´ˆê¸° MarkerClustering ìƒíƒœ:', typeof MarkerClustering);
        if (typeof MarkerClustering !== 'undefined') {
          console.log('âœ… MarkerClusteringì´ ì •ìƒì ìœ¼ë¡œ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
        } else {
          console.log('â³ MarkerClusteringì´ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë„¤ì´ë²„ ì§€ë„ API ë¡œë“œ í›„ ë™ì  ë¡œë“œë©ë‹ˆë‹¤.');
        }
      });

      // ë’¤ë¡œê°€ê¸° ë²„íŠ¼ ì²˜ë¦¬ëŠ” auth.jsì˜ handlePopStateì—ì„œ í†µí•© ê´€ë¦¬
      // ê¸°ì¡´ popstate ë¦¬ìŠ¤ë„ˆ ì œê±° - ì¤‘ë³µ ë°©ì§€

      // ì•± ì¢…ë£Œ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ ê´€ë ¨ í•¨ìˆ˜ë“¤ì€ auth.jsì—ì„œ í†µí•© ê´€ë¦¬
      // ì¤‘ë³µ ì œê±° - auth.jsì˜ showExitConfirmDialog ì‚¬ìš©

      // í˜ì´ì§€ ë¡œë“œ ì‹œ íˆìŠ¤í† ë¦¬ ìƒíƒœ ì„¤ì • (ëª¨ë°”ì¼ì—ì„œë§Œ)
      window.addEventListener('load', function() {
        // ëª¨ë°”ì¼ í™˜ê²½ì—ì„œë§Œ íˆìŠ¤í† ë¦¬ ìƒíƒœ ì„¤ì •
        if (window.location.pathname === '/' && typeof window.isMobileApp === 'function' && window.isMobileApp()) {
          window.history.replaceState({ page: 'main', preventBack: true }, '', '/');
          console.log('âœ… ëª¨ë°”ì¼ ë©”ì¸ í˜ì´ì§€ íˆìŠ¤í† ë¦¬ ìƒíƒœ ì„¤ì • ì™„ë£Œ');
        }
      });

      // í˜ì´ì§€ ì´ˆê¸° ë¡œë“œ ì‹œ íˆìŠ¤í† ë¦¬ ìŠ¤íƒ ì •ë¦¬ (ëª¨ë°”ì¼ì—ì„œë§Œ)
      document.addEventListener('DOMContentLoaded', function() {
        // ëª¨ë°”ì¼ í™˜ê²½ì—ì„œë§Œ íˆìŠ¤í† ë¦¬ ìŠ¤íƒ ì •ë¦¬
        if (window.location.pathname === '/' && typeof window.isMobileApp === 'function' && window.isMobileApp()) {
          // í˜„ì¬ íˆìŠ¤í† ë¦¬ ìƒíƒœë¥¼ ë©”ì¸ í˜ì´ì§€ë¡œ ì„¤ì •
          window.history.replaceState({ page: 'main', preventBack: true }, '', '/');
          
          // íˆìŠ¤í† ë¦¬ ê¸¸ì´ê°€ 1ë³´ë‹¤ í¬ë©´ ì¶”ê°€ íˆìŠ¤í† ë¦¬ í•­ëª©ë“¤ì„ ì œê±°
          if (window.history.length > 1) {
            console.log('ğŸ“± íˆìŠ¤í† ë¦¬ ìŠ¤íƒ ì •ë¦¬ ì¤‘...');
            // íˆìŠ¤í† ë¦¬ ìŠ¤íƒì„ ì •ë¦¬í•˜ê¸° ìœ„í•´ í˜„ì¬ ìƒíƒœë¥¼ ìœ ì§€í•˜ë©´ì„œ ë¶ˆí•„ìš”í•œ í•­ëª©ë“¤ ì œê±°
            window.history.go(-(window.history.length - 1));
            // ë‹¤ì‹œ ë©”ì¸ í˜ì´ì§€ ìƒíƒœë¡œ ì„¤ì •
            setTimeout(() => {
              window.history.replaceState({ page: 'main', preventBack: true }, '', '/');
              console.log('âœ… ëª¨ë°”ì¼ íˆìŠ¤í† ë¦¬ ìŠ¤íƒ ì •ë¦¬ ì™„ë£Œ');
            }, 100);
          }
        }
      });

      // í˜ì´ì§€ ë– ë‚˜ê¸° ë°©ì§€ (ëª¨ë°”ì¼ì—ì„œë§Œ)
      window.addEventListener('beforeunload', function(event) {
        // ëª¨ë°”ì¼ í™˜ê²½ì—ì„œë§Œ í˜ì´ì§€ ë– ë‚˜ê¸° ë°©ì§€
        if (typeof window.isMobileApp === 'function' && window.isMobileApp()) {
          // ë¡œê·¸ì¸ í™”ë©´ì´ ì•„ë‹Œ ë©”ì¸ ì•± í™”ë©´ì—ì„œë§Œ ì ìš©
          const loginScreen = document.getElementById('loginRequiredScreen');
          const appRoot = document.getElementById('appRoot');
          
          if (loginScreen && !loginScreen.classList.contains('hidden') && 
              appRoot && appRoot.classList.contains('hidden')) {
            // ë¡œê·¸ì¸ í™”ë©´ì—ì„œëŠ” ê¸°ë³¸ ë™ì‘ í—ˆìš©
            return;
          }
          
          // ë©”ì¸ ì•± í™”ë©´ì—ì„œëŠ” í˜ì´ì§€ ë– ë‚˜ê¸° ë°©ì§€
          console.log('ğŸ“± í˜ì´ì§€ ë– ë‚˜ê¸° ì‹œë„ ê°ì§€');
          event.preventDefault();
          event.returnValue = 'ì•±ì„ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?';
          return 'ì•±ì„ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?';
        }
      });

      // íˆìŠ¤í† ë¦¬ ë³€ê²½ ê°ì§€ ë° ê°•ì œ ë³µì› (ëª¨ë°”ì¼ì—ì„œë§Œ)
      let isHistoryManipulation = false;
      
      function forceMainPage() {
        if (isHistoryManipulation) return;
        
        isHistoryManipulation = true;
        console.log('ğŸ“± ê°•ì œ ë©”ì¸ í˜ì´ì§€ ë³µì›');
        
        // URLì´ ë©”ì¸ í˜ì´ì§€ê°€ ì•„ë‹ˆë©´ ê°•ì œë¡œ ë³€ê²½
        if (window.location.pathname !== '/') {
          window.history.replaceState({ page: 'main', preventBack: true }, '', '/');
        }
        
        // ì•±ì´ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ë‹¤ë©´ ì´ˆê¸°í™”
        if (typeof window.initializeApp === 'function') {
          window.initializeApp();
        }
        
        setTimeout(() => {
          isHistoryManipulation = false;
        }, 100);
      }

      // URL ë³€ê²½ ê°ì§€ (ëª¨ë°”ì¼ì—ì„œë§Œ)
      if (typeof window.isMobileApp === 'function' && window.isMobileApp()) {
        let currentUrl = window.location.href;
        setInterval(() => {
          if (window.location.href !== currentUrl) {
            currentUrl = window.location.href;
            if (window.location.pathname !== '/') {
              console.log('ğŸ“± URL ë³€ê²½ ê°ì§€:', window.location.pathname);
              forceMainPage();
            }
          }
        }, 100);
      }

      // ì¸ë¼ì¸ ë¡œê·¸ì¸ í¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      document.addEventListener('DOMContentLoaded', function() {
        const inlineLoginForm = document.getElementById('inlineLoginForm');
        if (inlineLoginForm) {
          inlineLoginForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const email = document.getElementById('inlineLoginEmail').value.trim();
            const password = document.getElementById('inlineLoginPassword').value;
            const errorMsg = document.getElementById('inlineLoginErrorMsg');
            const loginBtn = e.target.querySelector('button[type="submit"]');
            
            // ì…ë ¥ ê²€ì¦
            if (!email || !password) {
              showInlineError('ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
              return;
            }
            
            const EMAIL_RE = /^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/;
            if (!EMAIL_RE.test(email)) {
              showInlineError('ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.');
              return;
            }
            
            if (password.length < 6) {
              showInlineError('ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
              return;
            }
            
            // ë¡œê·¸ì¸ ë²„íŠ¼ ë¹„í™œì„±í™”
            const originalText = loginBtn.textContent;
            loginBtn.disabled = true;
            loginBtn.textContent = 'ë¡œê·¸ì¸ ì¤‘...';
            
            try {
              const response = await fetch('/api/auth/login', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                credentials: 'include',
                body: JSON.stringify({
                  email: email,
                  password: password
                })
              });
              
              const data = await response.json();
              
              if (response.ok) {
                console.log('ì¸ë¼ì¸ ë¡œê·¸ì¸ ì„±ê³µ:', data);
                
                // localStorageì— ì‚¬ìš©ì ì •ë³´ ì €ì¥
                try {
                  const userEmail = (data && data.user && data.user.email) ? data.user.email : email;
                  const isAdmin = !!(data && data.user && data.user.role === 'admin');
                  localStorage.setItem('X-USER', userEmail);
                  if (isAdmin) {
                    localStorage.setItem('X-USER-ADMIN', 'true');
                  } else {
                    localStorage.removeItem('X-USER-ADMIN');
                  }
                } catch (e) {
                  console.warn('localStorage ì €ì¥ ì¤‘ ê²½ê³ :', e);
                }

                // ì‚¬ìš©ì ì •ë³´ ì„¤ì • ë° ë¡œê·¸ì¸ í™”ë©´ ìˆ¨ê¸°ê¸°
                if (window.setCurrentUser) {
                  window.setCurrentUser(email);
                }
                if (window.hideLoginScreen) {
                  window.hideLoginScreen();
                }
                
                // íˆìŠ¤í† ë¦¬ ì´ˆê¸°í™” ë° ê³ ì •
                if (window.initializeHistory && window.fixHistoryAfterLogin) {
                  window.initializeHistory();
                  window.fixHistoryAfterLogin();
                }
                
              } else {
                console.log('ì¸ë¼ì¸ ë¡œê·¸ì¸ ì‹¤íŒ¨:', data.error);
                showInlineError(data.error || 'ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
              }
              
            } catch (error) {
              console.error('ì¸ë¼ì¸ ë¡œê·¸ì¸ ìš”ì²­ ì¤‘ ì˜¤ë¥˜:', error);
              showInlineError('ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            } finally {
              // ë¡œê·¸ì¸ ë²„íŠ¼ ë‹¤ì‹œ í™œì„±í™”
              loginBtn.disabled = false;
              loginBtn.textContent = originalText;
            }
          });
        }
        
        function showInlineError(message) {
          const errorMsg = document.getElementById('inlineLoginErrorMsg');
          if (errorMsg) {
            errorMsg.textContent = message;
            errorMsg.classList.add('show');
            setTimeout(() => {
              errorMsg.classList.remove('show');
            }, 5000);
          }
        }
      });
    </script>
  </div>
</body>
</html>
